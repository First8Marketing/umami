generator client {
  provider   = "prisma-client"
  output     = "../src/generated/prisma"
  engineType = "client"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id          String     @id @unique @map("user_id") @db.Uuid
  username    String     @unique @db.VarChar(255)
  password    String     @db.VarChar(60)
  role        String     @map("role") @db.VarChar(50)
  createdAt   DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime?  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt   DateTime?  @map("deleted_at") @db.Timestamptz(6)
  displayName String?    @map("display_name") @db.VarChar(255)
  logoUrl     String?    @map("logo_url") @db.VarChar(2183)
  ssoSubject  String?    @unique @map("sso_subject") @db.VarChar(255)
  ssoProvider String?    @map("sso_provider") @db.VarChar(50)
  email       String?    @unique @map("email") @db.VarChar(255)
  pictureUrl  String?    @map("picture_url") @db.VarChar(2183)
  ssoData     Json?      @map("sso_data")
  websites    Website[]  @relation("user")
  createdBy   Website[]  @relation("createUser")
  links       Link[]     @relation("user")
  pixels      Pixel[]    @relation("user")
  teams       TeamUser[]
  reports     Report[]

  @@index([email], map: "idx_user_email")
  @@index([ssoProvider], map: "idx_user_sso_provider")
  @@index([ssoSubject], map: "idx_user_sso_subject")
  @@map("user")
}

model Session {
  id            String         @id @unique @map("session_id") @db.Uuid
  websiteId     String         @map("website_id") @db.Uuid
  browser       String?        @db.VarChar(20)
  os            String?        @db.VarChar(20)
  device        String?        @db.VarChar(20)
  screen        String?        @db.VarChar(11)
  language      String?        @db.VarChar(35)
  country       String?        @db.Char(2)
  region        String?        @db.VarChar(20)
  city          String?        @db.VarChar(50)
  createdAt     DateTime?      @default(now()) @map("created_at") @db.Timestamptz(6)
  distinctId    String?        @map("distinct_id") @db.VarChar(50)
  userId        String?        @map("user_id") @db.VarChar(36)
  websiteEvents WebsiteEvent[]
  sessionData   SessionData[]
  revenue       Revenue[]

  @@index([createdAt])
  @@index([websiteId])
  @@index([websiteId, createdAt])
  @@index([websiteId, userId])
  @@index([websiteId, createdAt, browser])
  @@index([websiteId, createdAt, os])
  @@index([websiteId, createdAt, device])
  @@index([websiteId, createdAt, screen])
  @@index([websiteId, createdAt, language])
  @@index([websiteId, createdAt, country])
  @@index([websiteId, createdAt, region])
  @@index([websiteId, createdAt, city])
  @@index([userId], map: "idx_session_user_id")
  @@map("session")
}

model Website {
  id           String        @id @unique @map("website_id") @db.Uuid
  name         String        @db.VarChar(100)
  domain       String?       @db.VarChar(500)
  shareId      String?       @unique @map("share_id") @db.VarChar(50)
  resetAt      DateTime?     @map("reset_at") @db.Timestamptz(6)
  userId       String?       @map("user_id") @db.Uuid
  createdAt    DateTime?     @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime?     @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt    DateTime?     @map("deleted_at") @db.Timestamptz(6)
  createdBy    String?       @map("created_by") @db.Uuid
  teamId       String?       @map("team_id") @db.Uuid
  user         User?         @relation("user", fields: [userId], references: [id])
  createUser   User?         @relation("createUser", fields: [createdBy], references: [id])
  team         Team?         @relation(fields: [teamId], references: [id])
  eventData    EventData[]
  reports      Report[]
  revenue      Revenue[]
  segments     Segment[]
  sessionData  SessionData[]
  userMappings UserMapping[]

  @@index([userId])
  @@index([teamId])
  @@index([createdAt])
  @@index([shareId])
  @@index([createdBy])
  @@map("website")
}

model WebsiteEvent {
  id               String      @id @map("event_id") @db.Uuid
  websiteId        String      @map("website_id") @db.Uuid
  sessionId        String      @map("session_id") @db.Uuid
  createdAt        DateTime?   @default(now()) @map("created_at") @db.Timestamptz(6)
  urlPath          String      @map("url_path") @db.VarChar(500)
  urlQuery         String?     @map("url_query") @db.VarChar(500)
  referrerPath     String?     @map("referrer_path") @db.VarChar(500)
  referrerQuery    String?     @map("referrer_query") @db.VarChar(500)
  referrerDomain   String?     @map("referrer_domain") @db.VarChar(500)
  pageTitle        String?     @map("page_title") @db.VarChar(500)
  eventType        Int         @default(1) @map("event_type")
  eventName        String?     @map("event_name") @db.VarChar(50)
  visitId          String      @map("visit_id") @db.Uuid
  tag              String?     @db.VarChar(50)
  fbclid           String?     @db.VarChar(255)
  gclid            String?     @db.VarChar(255)
  lifatid          String?     @map("li_fat_id") @db.VarChar(255)
  msclkid          String?     @db.VarChar(255)
  ttclid           String?     @db.VarChar(255)
  twclid           String?     @db.VarChar(255)
  utmCampaign      String?     @map("utm_campaign") @db.VarChar(255)
  utmContent       String?     @map("utm_content") @db.VarChar(255)
  utmMedium        String?     @map("utm_medium") @db.VarChar(255)
  utmSource        String?     @map("utm_source") @db.VarChar(255)
  utmTerm          String?     @map("utm_term") @db.VarChar(255)
  hostname         String?     @db.VarChar(100)
  scrollDepth      Int?        @map("scroll_depth")
  timeOnPage       Int?        @map("time_on_page")
  clickCount       Int?        @map("click_count")
  formInteractions Json?       @map("form_interactions")
  commerceProductId      String?     @map("commerce_product_id") @db.VarChar(50)
  commerceCategoryId     String?     @map("commerce_category极速赛车开奖直播历史记录") @db.VarChar(50)
  commerceCartValue      Decimal?    @map("commerce_cart_value") @db.Decimal(19, 4)
  commerceCheckoutStep   Int?        @map("commerce_checkout_step")
  commerceOrderId        String?     @map("commerce_order_id") @db.VarChar(50)
  commerceRevenue        Decimal?    @map("commerce_revenue") @db.Decimal(19, 4)
  commercePlatform       String?     @map("commerce_platform") @db.VarChar(20)
  commerceProductName    String?     @map("commerce_product_name") @db.VarChar(255)
  commerceProductSku     String极速赛车开奖直播历史记录?     @map("commerce_product_sku") @db.VarChar(100)
  commerceProductPrice   Decimal?    @map("commerce_product_price") @db.Decimal(19, 4)
  commerceCurrency       String?     @map("commerce_currency") @db.VarChar(3) @default("USD")
  commerceQuantity       Int?        @map("commerce_quantity")
  commerceTaxAmount      Decimal?    @map("commerce_tax_amount") @db.Decimal(19, 4)
  commerceShippingAmount Decimal?    @map("commerce_shipping_amount") @db.Decimal(19, 4)
  commerceDiscountAmount Decimal?    @map("commerce_discount_amount") @db.Decimal(19, 4)
  eventData        EventData[]
  session          Session     @relation(fields: [sessionId], references: [id])

  @@index([createdAt])
  @@index([sessionId])
  @@index([visitId])
  @@index([websiteId])
  @@index([websiteId, createdAt])
  @@index([websiteId, createdAt, urlPath])
  @@index([websiteId, createdAt, urlQuery])
  @@index([websiteId, createdAt, referrerDomain])
  @@index([websiteId, createdAt, pageTitle])
  @@index([websiteId, createdAt, eventName])
  @@index([websiteId, createdAt, tag])
  @@index([websiteId, sessionId, createdAt])
  @@index([websiteId, visitId, createdAt])
  @@index([websiteId, createdAt, hostname])
  @@map("website_event")
}

model EventData {
  id             String       @id @map("event_data_id") @db.Uuid
  websiteId      String       @map("website_id") @db.Uuid
  websiteEventId String       @map("website_event_id") @db.Uuid
  dataKey        String       @map("data_key") @db.VarChar(500)
  stringValue    String?      @map("string_value") @db.VarChar(500)
  numberValue    Decimal?     @map("number_value") @db.Decimal(19, 4)
  dateValue      DateTime?    @map("date_value") @db.Timestamptz(6)
  dataType       Int          @map("data_type")
  createdAt      DateTime?    @default(now()) @map("created_at") @db.Timestamptz(6)
  website        Website      @relation(fields: [websiteId], references: [id])
  websiteEvent   WebsiteEvent @relation(fields: [websiteEventId], references: [id])

  @@index([createdAt])
  @@index([websiteId])
  @@index([websiteEventId])
  @@index([websiteId, createdAt])
  @@index([websiteId, createdAt, dataKey])
  @@map("event_data")
}

model SessionData {
  id          String    @id @map("session_data_id") @db.Uuid
  websiteId   String    @map("website_id") @db.Uuid
  sessionId   String    @map("session_id") @db.Uuid
  dataKey     String    @map("data_key") @db.VarChar(500)
  stringValue String?   @map("string_value") @db.VarChar(500)
  numberValue Decimal?  @map("number_value") @db.Decimal(19, 4)
  dateValue   DateTime? @map("date_value") @db.Timestamptz(6)
  dataType    Int       @map("data_type")
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  distinctId  String?   @map("distinct_id") @db.VarChar(50)
  website     Website   @relation(fields: [websiteId], references: [id])
  session     Session   @relation(fields: [sessionId], references: [id])

  @@index([createdAt])
  @@index([websiteId])
  @@index([sessionId])
  @@index([sessionId, createdAt])
  @@index([websiteId, createdAt, dataKey])
  @@map("session_data")
}

model Team {
  id         String     @id @unique @map("team_id") @db.Uuid
  name       String     @db.VarChar(50)
  accessCode String?    @unique @map("access_code") @db.VarChar(50)
  createdAt  DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime?  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt  DateTime?  @map("deleted_at") @db.Timestamptz(6)
  logoUrl    String?    @map("logo_url") @db.VarChar(2183)
  websites   Website[]
  members    TeamUser[]
  links      Link[]
  pixels     Pixel[]

  @@index([accessCode])
  @@map("team")
}

model TeamUser {
  id        String    @id @unique @map("team_user_id") @db.Uuid
  teamId    String    @map("team_id") @db.Uuid
  userId    String    @map("user_id") @db.Uuid
  role      String    @db.VarChar(50)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  team      Team      @relation(fields: [teamId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@index([teamId])
  @@index([userId])
  @@map("team_user")
}

model Report {
  id          String    @id @unique @map("report_id") @db.Uuid
  userId      String    @map("user_id") @db.Uuid
  websiteId   String    @map("website_id") @db.Uuid
  type        String    @db.VarChar(50)
  name        String    @db.VarChar(200)
  description String    @db.VarChar(500)
  parameters  Json
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt   DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  user        User      @relation(fields: [userId], references: [id])
  website     Website   @relation(fields: [websiteId], references: [id])

  @@index([userId])
  @@index([websiteId])
  @@index([type])
  @@index([name])
  @@map("report")
}

model Segment {
  id         String    @id @unique @map("segment_id") @db.Uuid
  websiteId  String    @map("website_id") @db.Uuid
  type       String    @db.VarChar(50)
  name       String    @db.VarChar(200)
  parameters Json
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  website    Website   @relation(fields: [websiteId], references: [id])

  @@index([websiteId])
  @@map("segment")
}

model Revenue {
  id        String    @id @unique @map("revenue_id") @db.Uuid
  websiteId String    @map("website_id") @db.Uuid
  sessionId String    @map("session_id") @db.Uuid
  eventId   String    @map("event_id") @db.Uuid
  eventName String    @map("event_name") @db.VarChar(50)
  currency  String    @db.VarChar(10)
  revenue   Decimal?  @db.Decimal(19, 4)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  website   Website   @relation(fields: [websiteId], references: [id])
  session   Session   @relation(fields: [sessionId], references: [id])

  @@index([websiteId])
  @@index([sessionId])
  @@index([websiteId, createdAt])
  @@index([websiteId, sessionId, createdAt])
  @@map("revenue")
}

model Link {
  id        String    @id @unique @map("link_id") @db.Uuid
  name      String    @db.VarChar(100)
  url       String    @db.VarChar(500)
  slug      String    @unique @db.VarChar(100)
  userId    String?   @map("user_id") @db.Uuid
  teamId    String?   @map("team_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(6)
  user      User?     @relation("user", fields: [userId], references: [id])
  team      Team?     @relation(fields: [teamId], references: [id])

  @@index([slug])
  @@index([userId])
  @@index([teamId])
  @@index([createdAt])
  @@map("link")
}

model Pixel {
  id        String    @id @unique @map("pixel_id") @db.Uuid
  name      String    @db.VarChar(100)
  slug      String    @unique @db.VarChar(100)
  userId    String?   @map("user_id") @db.Uuid
  teamId    String?   @map("team_id") @db.Uuid
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt DateTime? @map("deleted_at") @db.Timestamptz(6)
  user      User?     @relation("user", fields: [userId], references: [id])
  team      Team?     @relation(fields: [teamId], references: [id])

  @@index([slug])
  @@index([userId])
  @@index([teamId])
  @@index([createdAt])
  @@map("pixel")
}

model UserMapping {
  id           Int       @id @default(autoincrement())
  visitorId    String    @map("visitor_id") @db.VarChar(36)
  userId       String    @map("user_id") @db.VarChar(36)
  firstSeenAt  DateTime? @default(now()) @map("first_seen_at") @db.Timestamptz(6)
  lastSeenAt   DateTime? @default(now()) @map("last_seen_at") @db.Timestamptz(6)
  sessionCount Int?      @default(1) @map("session_count")
  websiteId    String    @map("website_id") @db.Uuid
  website      Website   @relation(fields: [websiteId], references: [id])

  @@unique([visitorId, userId])
  @@index([websiteId, userId])
  @@index([lastSeenAt], map: "idx_user_mapping_last_seen")
  @@index([userId], map: "idx_user_mapping_user")
  @@index([visitorId], map: "idx_user_mapping_visitor")
  @@map("user_mapping")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model ml_models {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                 String    @db.VarChar(100)
  version              String    @db.VarChar(50)
  model_type           String?   @db.VarChar(50)
  algorithm            String?   @db.VarChar(100)
  hyperparameters      Json?
  training_data_period Json?
  metrics              Json?
  artifact_path        String?   @db.VarChar(500)
  artifact_size_bytes  BigInt?
  status               String?   @db.VarChar(20)
  is_active            Boolean?  @default(false)
  trained_at           DateTime? @db.Timestamptz(6)
  deployed_at          DateTime? @db.Timestamptz(6)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([name, version])
  @@index([name], map: "idx_ml_models_name")
  @@index([status], map: "idx_ml_models_status")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model model_training_runs {
  id                    BigInt    @id @default(autoincrement())
  model_type            String    @db.VarChar(100)
  training_started_at   DateTime  @default(now()) @db.Timestamptz(6)
  training_completed_at DateTime? @db.Timestamptz(6)
  status                String    @default("running") @db.VarChar(50)
  metrics               Json?     @default("{}")
  parameters            Json?     @default("{}")
  error_message         String?
  tenant_id             String?   @db.Uuid

  @@index([model_type], map: "idx_model_training_runs_model_type")
  @@index([training_started_at(sort: Desc)], map: "idx_model_training_runs_started_at")
  @@index([status], map: "idx_model_training_runs_status")
}

model product_metrics_daily {
  time              DateTime @db.Date
  website_id        String   @db.Uuid
  product_id        String   @db.VarChar(50)
  views             Int?     @default(0)
  unique_viewers    Int?     @default(0)
  avg_time_viewed   Int?
  add_to_cart_count Int?     @default(0)
  purchase_count    Int?     @default(0)
  conversion_rate   Decimal? @db.Decimal(5, 4)
  revenue           Decimal? @default(0) @db.Decimal(19, 4)
  units_sold        Int?     @default(0)

  @@id([time, website_id, product_id])
  @@index([time(sort: Desc)])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_similarities {
  id               BigInt   @id @default(autoincrement())
  product_id_1     String   @db.VarChar(255)
  product_id_2     String   @db.VarChar(255)
  similarity_score Decimal  @db.Decimal(10, 6)
  algorithm        String   @db.VarChar(100)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  tenant_id        String?  @db.Uuid

  @@unique([product_id_1, product_id_2, algorithm], map: "unique_product_pair")
  @@index([product_id_1], map: "idx_product_similarities_product_1")
  @@index([product_id_2], map: "idx_product_similarities_product_2")
  @@index([similarity_score(sort: Desc)], map: "idx_product_similarities_score")
  @@index([tenant_id, product_id_1, product_id_2], map: "idx_product_similarities_tenant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model products {
  id           BigInt   @id @default(autoincrement())
  product_id   String   @unique @db.VarChar(255)
  name         String
  description  String?
  categories   String[]
  price        Decimal? @db.Decimal(19, 4)
  stock_status String?  @db.VarChar(50)
  created_at   DateTime @default(now()) @db.Timestamptz(6)
  updated_at   DateTime @default(now()) @db.Timestamptz(6)
  metadata     Json?    @default("{}")
  tenant_id    String?  @db.Uuid

  @@index([categories], map: "idx_products_categories", type: Gin)
  @@index([product_id], map: "idx_products_product_id")
  @@index([tenant_id, product_id], map: "idx_products_tenant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recommendation_cache {
  id              BigInt   @id @default(autoincrement())
  user_id         String   @db.VarChar(255)
  recommendations Json
  algorithm       String   @db.VarChar(100)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  expires_at      DateTime @db.Timestamptz(6)

  @@unique([user_id, algorithm], map: "unique_user_recommendation")
  @@index([expires_at], map: "idx_recommendation_cache_expires_at")
  @@index([user_id], map: "idx_recommendation_cache_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model recommendations {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id              String    @db.Uuid
  user_id                 String?   @db.VarChar(255)
  website_id              String    @db.Uuid
  recommendation_type     String?   @db.VarChar(50)
  item_id                 String    @db.VarChar(255)
  score                   Decimal?  @db.Decimal(5, 4)
  rank                    Int?
  context                 Json?
  strategy                String?   @db.VarChar(50)
  model_version           String?   @db.VarChar(50)
  personalization_factors Json?
  shown                   Boolean?  @default(true)
  clicked                 Boolean?  @default(false)
  converted               Boolean?  @default(false)
  revenue                 Decimal?  @db.Decimal(19, 4)
  shown_at                DateTime? @default(now()) @db.Timestamptz(6)
  clicked_at              DateTime? @db.Timestamptz(6)
  converted_at            DateTime? @db.Timestamptz(6)
  tenant_id               String?   @db.Uuid

  @@index([item_id], map: "idx_recommendations_item")
  @@index([clicked, converted], map: "idx_recommendations_outcome")
  @@index([session_id], map: "idx_recommendations_session")
  @@index([shown_at], map: "idx_recommendations_shown_at")
  @@index([tenant_id, user_id], map: "idx_recommendations_tenant_user")
  @@index([user_id], map: "idx_recommendations_user")
  @@index([website_id], map: "idx_recommendations_website")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_api_keys {
  api_key_id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id             String    @db.Uuid
  key_name              String    @db.VarChar(100)
  key_hash              String    @unique
  key_prefix            String    @db.VarChar(20)
  key_type              String    @default("live") @db.VarChar(20)
  permissions           Json?     @default("{\"read\": true, \"write\": false}")
  status                String    @default("active") @db.VarChar(50)
  rate_limit_per_minute Int?      @default(60)
  last_used_at          DateTime? @db.Timestamptz(6)
  usage_count           BigInt?   @default(0)
  expires_at            DateTime? @db.Timestamptz(6)
  created_at            DateTime  @default(now()) @db.Timestamptz(6)
  updated_at            DateTime  @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, key_name], map: "unique_tenant_key_name")
  @@index([key_hash], map: "idx_api_keys_hash")
  @@index([key_prefix], map: "idx_api_keys_prefix")
  @@index([status], map: "idx_api_keys_status")
  @@index([tenant_id], map: "idx_api_keys_tenant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_audit_log {
  log_id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id          String   @db.Uuid
  action_type        String   @db.VarChar(100)
  action_description String?
  actor_type         String?  @db.VarChar(50)
  actor_id           String?  @db.VarChar(255)
  ip_address         String?  @db.Inet
  user_agent         String?
  status             String   @db.VarChar(50)
  error_message      String?
  metadata           Json?    @default("{}")
  created_at         DateTime @default(now()) @db.Timestamptz(6)

  @@index([action_type], map: "idx_audit_log_action")
  @@index([status], map: "idx_audit_log_status")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_audit_log_tenant")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_umami_configs {
  config_id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                   String    @unique(map: "unique_tenant_umami") @db.Uuid
  umami_db_host               String    @db.VarChar(255)
  umami_db_port               Int       @default(5432)
  umami_db_name               String    @db.VarChar(100)
  umami_db_user               String    @db.VarChar(100)
  umami_db_password_encrypted String
  umami_db_ssl_mode           String?   @default("prefer") @db.VarChar(50)
  umami_website_id            String    @db.Uuid
  sync_enabled                Boolean?  @default(true)
  sync_interval_minutes       Int?      @default(30)
  last_sync_at                DateTime? @db.Timestamptz(6)
  last_sync_status            String?   @db.VarChar(50)
  pool_min_size               Int?      @default(1)
  pool_max_size               Int?      @default(5)
  created_at                  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime  @default(now()) @db.Timestamptz(6)

  @@index([sync_enabled, last_sync_at], map: "idx_umami_configs_sync")
  @@index([tenant_id], map: "idx_umami_configs_tenant")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_usage_metrics {
  metric_id                 String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                 String   @db.Uuid
  metric_date               DateTime @db.Date
  api_requests_count        Int?     @default(0)
  api_errors_count          Int?     @default(0)
  products_count            Int?     @default(0)
  interactions_count        Int?     @default(0)
  recommendations_generated Int?     @default(0)
  avg_response_time_ms      Decimal? @db.Decimal(10, 2)
  p95_response_time_ms      Decimal? @db.Decimal(10, 2)
  created_at                DateTime @default(now()) @db.Timestamptz(6)
  updated_at                DateTime @default(now()) @db.Timestamptz(6)

  @@unique([tenant_id, metric_date], map: "unique_tenant_metric_date")
  @@index([tenant_id, metric_date(sort: Desc)], map: "idx_usage_metrics_tenant_date")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenant_wordpress_configs {
  config_id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_id                   String    @unique(map: "unique_tenant_wordpress") @db.Uuid
  wordpress_url               String    @db.VarChar(500)
  wordpress_api_key_encrypted String
  sync_enabled                Boolean?  @default(true)
  sync_interval_minutes       Int?      @default(60)
  last_sync_at                DateTime? @db.Timestamptz(6)
  last_sync_status            String?   @db.VarChar(50)
  created_at                  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                  DateTime  @default(now()) @db.Timestamptz(6)

  @@index([sync_enabled, last_sync_at], map: "idx_wordpress_configs_sync")
  @@index([tenant_id], map: "idx_wordpress_configs_tenant")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tenants {
  tenant_id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenant_name          String    @db.VarChar(255)
  tenant_slug          String    @unique @db.VarChar(100)
  email                String    @unique @db.VarChar(255)
  status               String    @default("active") @db.VarChar(50)
  plan_type            String    @default("free") @db.VarChar(50)
  max_requests_per_day Int?      @default(1000)
  max_products         Int?      @default(1000)
  created_at           DateTime  @default(now()) @db.Timestamptz(6)
  updated_at           DateTime  @default(now()) @db.Timestamptz(6)
  last_active_at       DateTime? @db.Timestamptz(6)
  settings             Json?     @default("{}")

  @@index([email], map: "idx_tenants_email")
  @@index([tenant_slug], map: "idx_tenants_slug")
  @@index([status], map: "idx_tenants_status")
}

model time_series_events {
  time        DateTime @db.Timestamptz(6)
  website_id  String   @db.Uuid
  session_id  String   @db.Uuid
  user_id     String?  @db.VarChar(255)
  event_type  String   @db.VarChar(50)
  event_name  String?  @db.VarChar(50)
  event_value Decimal? @db.Decimal(19, 4)
  properties  Json?
  page_url    String?  @db.VarChar(500)
  product_id  String?  @db.VarChar(50)
  category    String?  @db.VarChar(100)
  device      String?  @db.VarChar(20)
  country     String?  @db.Char(2)

  @@id([time, website_id, session_id])
  @@index([event_type, time(sort: Desc)], map: "idx_ts_events_event_type")
  @@index([session_id, time(sort: Desc)], map: "idx_ts_events_session")
  @@index([website_id, time(sort: Desc)], map: "idx_ts_events_website")
  @@index([time(sort: Desc)])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_preferences {
  id                   BigInt   @id @default(autoincrement())
  user_id              String   @unique @db.VarChar(255)
  preferred_categories String[]
  price_range_min      Decimal? @db.Decimal(19, 4)
  price_range_max      Decimal? @db.Decimal(19, 4)
  feature_vector       Json?
  created_at           DateTime @default(now()) @db.Timestamptz(6)
  updated_at           DateTime @default(now()) @db.Timestamptz(6)

  @@index([user_id], map: "idx_user_preferences_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_product_interactions {
  id                BigInt   @id @default(autoincrement())
  user_id           String   @db.VarChar(255)
  product_id        String   @db.VarChar(255)
  interaction_type  String   @db.VarChar(50)
  interaction_value Decimal  @default(1.0) @db.Decimal(10, 4)
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  metadata          Json?    @default("{}")
  tenant_id         String?  @db.Uuid

  @@unique([user_id, product_id, interaction_type, created_at], map: "unique_interaction")
  @@index([tenant_id, created_at(sort: Desc)], map: "idx_interactions_tenant_created")
  @@index([tenant_id, product_id], map: "idx_interactions_tenant_product")
  @@index([tenant_id, user_id], map: "idx_interactions_tenant_user")
  @@index([created_at(sort: Desc)], map: "idx_user_interactions_created_at")
  @@index([product_id], map: "idx_user_interactions_product_id")
  @@index([interaction_type], map: "idx_user_interactions_type")
  @@index([user_id], map: "idx_user_interactions_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_profiles {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id              String    @unique @db.VarChar(255)
  website_id           String    @db.Uuid
  lifecycle_stage      String?   @db.VarChar(50)
  funnel_position      String?   @db.VarChar(50)
  session_count        Int?      @default(0)
  total_pageviews      Int?      @default(0)
  total_events         Int?      @default(0)
  total_purchases      Int?      @default(0)
  total_revenue        Decimal?  @default(0) @db.Decimal(19, 4)
  avg_session_duration Int?
  avg_time_on_page     Int?
  avg_scroll_depth     Int?
  bounce_rate          Decimal?  @db.Decimal(5, 4)
  favorite_categories  Json?
  favorite_products    Json?
  price_sensitivity    String?   @db.VarChar(20)
  preferred_brands     Json?
  device_preference    String?   @db.VarChar(20)
  first_visit          DateTime? @db.Timestamptz(6)
  last_visit           DateTime? @db.Timestamptz(6)
  created_at           DateTime? @default(now()) @db.Timestamptz(6)
  updated_at           DateTime? @default(now()) @db.Timestamptz(6)
  tenant_id            String?   @db.Uuid

  @@index([last_visit], map: "idx_user_profiles_last_visit")
  @@index([lifecycle_stage], map: "idx_user_profiles_lifecycle")
  @@index([tenant_id, user_id], map: "idx_user_profiles_tenant")
  @@index([user_id], map: "idx_user_profiles_user_id")
  @@index([website_id], map: "idx_user_profiles_website_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_purchases {
  id         BigInt   @id @default(autoincrement())
  user_id    String   @db.VarChar(255)
  order_id   String   @unique @db.VarChar(255)
  revenue    Decimal  @default(0) @db.Decimal(19, 4)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  metadata   Json?    @default("{}")

  @@index([created_at(sort: Desc)], map: "idx_user_purchases_created_at")
  @@index([user_id], map: "idx_user_purchases_user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model user_sessions {
  id         BigInt   @id @default(autoincrement())
  session_id String   @unique @db.VarChar(255)
  user_id    String?  @db.VarChar(255)
  visitor_id String?  @db.VarChar(255)
  device     String?  @db.VarChar(100)
  browser    String?  @db.VarChar(100)
  os         String?  @db.VarChar(100)
  country    String?  @db.VarChar(10)
  city       String?  @db.VarChar(100)
  created_at DateTime @default(now()) @db.Timestamptz(6)
  updated_at DateTime @default(now()) @db.Timestamptz(6)
  metadata   Json?    @default("{}")

  @@index([created_at(sort: Desc)], map: "idx_user_sessions_created_at")
  @@index([user_id], map: "idx_user_sessions_user_id")
  @@index([visitor_id], map: "idx_user_sessions_visitor_id")
}

model website_metrics_hourly {
  time                 DateTime @db.Timestamptz(6)
  website_id           String   @db.Uuid
  pageviews            Int?     @default(0)
  unique_sessions      Int?     @default(0)
  unique_users         Int?     @default(0)
  avg_time_on_page     Int?
  avg_scroll_depth     Int?
  bounce_rate          Decimal? @db.Decimal(5, 4)
  add_to_cart_count    Int?     @default(0)
  checkout_start_count Int?     @default(0)
  purchase_count       Int?     @default(0)
  conversion_rate      Decimal? @db.Decimal(5, 4)
  total_revenue        Decimal? @default(0) @db.Decimal(19, 4)
  avg_order_value      Decimal? @db.Decimal(19, 4)

  @@id([time, website_id])
  @@index([time(sort: Desc)])
}
